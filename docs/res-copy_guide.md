# Стратегія резервного копіювання
Резервне копіювання має забезпечити можливість відновлення системи у разі втрати даних, пошкодження файлів або збою сервера. Основні принципи:
- Захист від втрати даних.
- Мінімізація простою системи.
- Автоматизація процесів резервного копіювання та відновлення.

# Типи резервних копій
1. **Повне резервне копіювання** – створення копії всієї бази даних та файлів.
2. **Інкрементальне резервне копіювання** – збереження лише змінених даних після останньої резервної копії.
3. **Диференціальне резервне копіювання** – копіювання змін з моменту останнього повного резервного копіювання.

# Частота створення резервних копій
- **Повне резервне копіювання** – 1 раз на тиждень.
- **Інкрементальне резервне копіювання** – кожні 12 годин.
- **Диференціальне резервне копіювання** – щодня.

# Зберігання та ротація копій
- Використання політики **GFS (Grandfather-Father-Son)**:
  - Щоденні копії зберігаються протягом 7 днів.
  - Щотижневі копії – протягом 1 місяця.
  - Щомісячні копії – зберігаються протягом 6 місяців.
- Локальне та хмарне резервне копіювання.

# Процедура резервного копіювання
## 1. Бази даних (MongoDB Atlas)
- Використання **MongoDB Atlas Backup** (автоматичні знімки).
- Створення ручних резервних копій:
  ```sh
  mongodump --uri="mongodb+srv://user:password@cluster.mongodb.net/dbname" --out=/backup/mongo/
  ```

## 2. Файли конфігурацій
- Збереження файлів `.env`, `next.config.js`, `package.json`.
- Використання `tar` для архівації:
  ```sh
  tar -czvf /backup/configs.tar.gz .env next.config.js package.json
  ```

## 3. Користувацькі дані
- Якщо зберігаються у файловій системі, створити архів:
  ```sh
  tar -czvf /backup/uploads.tar.gz ./public/uploads
  ```

## 4. Логи системи
- Створення копій логів з `logs/`:
  ```sh
  cp -r /var/logs/myapp/ /backup/logs/
  ```

# Перевірка цілісності резервних копій
- Перевірка бази даних після резервного копіювання:
  ```sh
  mongorestore --dryRun --uri="mongodb://localhost:27017/testdb" /backup/mongo/
  ```
- Перевірка файлів:
  ```sh
  tar -tzf /backup/configs.tar.gz
  ```

# Автоматизація процесу резервного копіювання
- Створення **cron job** для щоденного резервного копіювання:
  ```sh
  0 2 * * * /usr/bin/mongodump --uri="mongodb+srv://user:password@cluster.mongodb.net/dbname" --out=/backup/mongo/
  ```
- Використання **AWS Lambda/S3 lifecycle** для автоматичного збереження та видалення старих резервних копій.

# Процедура відновлення з резервних копій
## 1. Повне відновлення системи
- Відновлення бази даних:
  ```sh
  mongorestore --uri="mongodb+srv://user:password@cluster.mongodb.net/dbname" /backup/mongo/
  ```
- Розгортання файлів конфігурацій:
  ```sh
  tar -xzvf /backup/configs.tar.gz -C /app/
  ```

## 2. Вибіркове відновлення даних
- Відновлення окремої колекції MongoDB:
  ```sh
  mongorestore --uri="mongodb+srv://user:password@cluster.mongodb.net/dbname" --collection users --db dbname /backup/mongo/dbname/users.bson
  ```

# Тестування відновлення
- Перевірка кожної резервної копії на тестовому сервері раз на місяць.
- Автоматизоване порівняння контрольних сум (`sha256sum`).

